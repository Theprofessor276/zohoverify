<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Cart</title>
  <style>
    body { font-family: sans-serif; padding: 30px; background: #fafafa; }
    .back { margin-bottom: 20px; cursor: pointer; color: blue; text-decoration: underline; }
    .item {
      background: white;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-buttons {
      display: flex;
      gap: 8px;
    }
    .btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .decrease-btn {
      background: orange;
      color: white;
    }
    .clear-btn {
      background: #888;
      color: white;
      margin-top: 20px;
    }
    .checkout-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: green;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="back" onclick="goBack()">← Back to Shop</div>
  <h2>Your Cart</h2>
  <div id="cartItems"></div>
  <button class="clear-btn btn" onclick="clearCart()">Clear Cart</button>
  <button class="checkout-btn" onclick="checkout()">Checkout</button>

  <script>
    function loadCart() {
      try {
        return JSON.parse(localStorage.getItem('cart')) || {};
      } catch {
        return {};
      }
    }

    function saveCart(cart) {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function decreaseItem(itemName) {
      const cart = loadCart();
      if (cart[itemName]) {
        cart[itemName].quantity -= 1;
        if (cart[itemName].quantity <= 0) {
          delete cart[itemName];
        }
        saveCart(cart);
        renderCart();
      }
    }

    function clearCart() {
      if (confirm("Are you sure you want to clear your cart?")) {
        localStorage.removeItem('cart');
        renderCart();
      }
    }

    function formatPrice(num) {
      return (typeof num === 'number' && !isNaN(num)) ? num.toFixed(2) : '0.00';
    }

    function renderCart() {
      const cart = loadCart();
      const cartDiv = document.getElementById('cartItems');
      cartDiv.innerHTML = '';
      let total = 0;

      if (Object.keys(cart).length === 0) {
        cartDiv.innerText = "Your cart is empty.";
        return;
      }

      for (const item in cart) {
        const entry = cart[item];
        const quantity = entry.quantity ?? 0;
        const price = entry.price ?? 0;
        const subtotal = price * quantity;
        total += subtotal;

        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <span>${item} — $${formatPrice(price)} × ${quantity} = $${formatPrice(subtotal)}</span>
          <div class="item-buttons">
            <button class="btn decrease-btn" onclick="decreaseItem('${item}')">−</button>
          </div>
        `;
        cartDiv.appendChild(div);
      }

      const totalDiv = document.createElement('div');
      totalDiv.style.marginTop = '15px';
      totalDiv.innerHTML = `<strong>Total: $${formatPrice(total)}</strong>`;
      cartDiv.appendChild(totalDiv);
    }

    function goBack() {
      window.location.href = "index.html";
    }

    function checkout() {
      window.location.href = "error.html";
    }

    renderCart(); // Initialize cart on load
  </script>

</body>
</html>
